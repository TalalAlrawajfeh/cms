package usecases;

import java.util.Objects;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.servlet.ModelAndView;

import beans.User;
import entities.UserEntity;
import persistence.UserRepository;
import utils.CopyUtil;
import utils.HashUtil;

public class LoginUseCase {
	@Autowired
	private UserRepository userRepository;

	public void validateUser(String username) throws InvalidUserException {
		UserEntity userEntity = userRepository.findByUsername(username);
		if (Objects.nonNull(userEntity)) {
			if (userEntity.getPasswordHashCode().equalsIgnoreCase(HashUtil.hashString(password))) {
				logger.info(USER_STRING + username + USER_HAS_LOGGED_IN_LOG);
				User user = CopyUtil.createAndCopyFields(User.class, userEntity);
				req.getSession(true).setAttribute(USER_SESSION_ATTRIBUTE_NAME, user);
				return new ModelAndView(USER_MANAGEMENT_PAGE);
			} else {
				throw new InvalidUserException( (Throwable) 4);
			}
		} else {
			logger.info(ATTEMPT_TO_LOGIN_WITH_UNKNOWN_USER_LOG + username);
		}
	}
}
